/*! fg-enlarge - v0.1.0 - 2017-05-30
* Copyright (c) 2017 Scott Jehl, Filament Group, Inc.; Licensed  */
!function(a){var b=function(){var b=a.jQuery,c="enlarge";b.fn[c]=function(d){var e=arguments,f={button:!0,hoverZoomWithoutClick:!0,delay:300,flyout:{width:200,height:200},placement:"inline",magnification:3};"string"!=typeof d&&(f=b.extend(f,d));var g,h=this.each(function(){function h(){"inline"===f.placement?(C=B,M=L,K=J):(C=V.find("img")[0],M=K=V)}function i(){V.css({width:f.flyout.width+"px",height:f.flyout.height+"px",top:"",left:"","margin-left":"","margin-top":""});var a=f.placement.match(/left|right/);a&&V.css(a[0],-f.flyout.width+"px");var b=f.placement.match(/loupe/);b&&V.css({"margin-left":-f.flyout.width/2+"px","margin-top":-f.flyout.height/2+"px"}),V[0].className=V[0].className.replace(/enlarge_flyout\-[^$\s]+/," "),V.addClass("enlarge_flyout-"+f.placement)}function j(){J.append('<i class="enlarge_loader"><i></i></i>')}function k(){N=!N,v.data("zoomed",N)}function l(){if(N){var a=new Image;a.className="enlarge_img-loading",b(a).insertBefore(C),a.onload=function(){C.sizes=a.sizes,z||(C.src=G),b(a).remove()},a.sizes=o()+"px",a.srcset=E,z||(a.src=G)}else C.sizes=F,z||(C.src=D)}function m(){var a=K.width(),b=K.height(),c=C.offsetWidth,d=C.offsetHeight;K[0].scrollLeft=c/2-a/2,K[0].scrollTop=d/2-b/2}function n(){O?(L.add(M).removeClass(P),O=!1,K.removeAttr("tabindex")):(L.add(M).addClass(P),O=!0,K.attr("tabindex","0"),K[0].focus())}function o(){return L[0].offsetWidth*f.magnification}function p(){N?("inline"===f.placement&&J.add(L).css({width:L[0].offsetWidth+"px",height:parseFloat(getComputedStyle(L[0]).height)+"px"}),M.addClass(H),b(C).css("width",o()+"px"),b(w).trigger(c+".after-zoom-in")):(M.removeClass(H),"inline"===f.placement&&J.add(L).css({width:"",height:""}),b(C).css("width",""),b(w).trigger(c+".after-zoom-out"))}function q(){function a(){f.placement=d,h(),b(w).unbind(c+".after-zoom-out",a)}var d=f.placement;"inline"!==d&&(b(w).bind(c+".after-zoom-out",a),f.placement="inline",h())}function r(){k(),l(),p(),m(),n()}function s(a){"touchstart"===a.type&&(T=!0),T&&"mouseenter"===a.type||"mouseenter"===a.type&&!T&&!U||O||S||(S=!0,J.addClass(I),R=setTimeout(function(){J.removeClass(I),k(),p(),l(),Q=!0,u(a)},f.delay))}function t(a){J.removeClass(I),clearTimeout(R),Q=!1,f.hoverZoomWithoutClick!==!1||T||(U=!1),T&&"mouseleave"===a.type&&(T=!1)}function u(a){if(Q){if(T&&"mousemove"===a.type)return;var b=a.touches?a.touches[0]:a;a.preventDefault();var c=b.clientX-J[0].getBoundingClientRect().left,d=b.clientY-J[0].getBoundingClientRect().top;if(f.placement.match(/loupe/)){var e=(a.touches?-f.flyout.width/1.3:-f.flyout.width/2)+"px",g=(a.touches?-f.flyout.height/1.3:-f.flyout.height/2)+"px";requestAnimationFrame(function(){V.css({top:d+"px",left:c+"px","margin-left":e,"margin-top":g})})}var h=J[0].offsetWidth,i=J[0].offsetHeight,j=C.offsetWidth,k=C.offsetHeight,l=K[0].offsetWidth,m=K[0].offsetHeight;K[0].scrollLeft=c/h*(j-l),K[0].scrollTop=d/i*(k-m)}}var v=b(this),w=this,x=a.document.createElement("img"),y="srcset"in x,z=y&&"sizes"in x,A=b(this).find("a"),B=v.find("img")[0],C=B,D=C.src,E=b(C).attr("srcset"),F=b(C).attr("sizes"),G=A[0].href,H=(A[0].innerText,c+"-zoomed"),I=c+"-delay",J=b(C).closest(".enlarge_contain"),K=J,L=b(C).closest(".enlarge_pane")||v,M=L,N=v.data("zoomed")||!1;v.data("zoomed",N);var O=!1,P=c+"-locked";if("string"!=typeof d){v.data("updateUptions",function(a){f=a,h(),i(),U=f.hoverZoomWithoutClick,f.image.sizes&&(F=f.image.sizes,l())});var Q,R,S,T,U=f.hoverZoomWithoutClick,V=b('<div class="enlarge_flyout"></div>').append(J.clone());V.insertAfter(L),j(),h(),i(),A.bind("keydown",function(a){(13===a.keyCode||32===a.keyCode)&&q(),32===a.keyCode&&(a.preventDefault(),b(this).trigger("click"))}).bind("click",function(a){a.preventDefault(),r()}),b(a).bind("resize",function(a){O&&r()}),b(a.document).bind("mouseup",function(a){O&&!b(a.target).closest(L).length&&r()}),b(B).bind("mouseenter touchstart",s).bind("mousemove touchmove",u).bind("mouseleave touchend",function(a){S=!1,N&&!O&&(k(),l(),p()),t(a)}).bind("click",function(a){a.preventDefault(),T&&"inline"===f.placement&&r(),f.hoverZoomWithoutClick!==!1||T||(U=!U,U?b(this).trigger("mouseenter"):b(this).trigger("mouseleave"))}),b(this).bind("keydown keyup",function(a){37===a.keyCode||38===a.keyCode||39===a.keyCode||40===a.keyCode?(a.stopImmediatePropagation(),O||a.preventDefault()):"keyup"===a.type&&O&&27===a.keyCode&&(r(),A[0].focus(),a.stopImmediatePropagation())}),L.bind("scroll",function(){N&&(k(),l(),p()),O&&n()})}else{var W=Array.prototype.slice.call(e,1);switch(d){case"in":v.data("zoomed")||r();break;case"out":v.data("zoomed")&&r();break;case"isZoomed":g=v.data("zoomed");break;case"updateOptions":v.data("updateUptions")(W[0])}}});return void 0!==g?g:h}};"undefined"!=typeof module?module.exports=b:b()}("undefined"!=typeof global?global:this);